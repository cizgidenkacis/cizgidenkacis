<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Çizgiden Kaçış</title>
<style>
    body {
        margin: 0;
        overflow: hidden;
        background: black;
        font-family: Arial, sans-serif;
        color: white;
    }

    #menu, #pauseMenu, #settingsMenu {
        position: absolute;
        top: 0; left: 0;
        width: 100%;
        height: 100%;
        background: black;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 10;
    }

    button {
        padding: 15px 35px;
        margin: 12px;
        font-size: 23px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
    }

    #pauseBtn {
        position: absolute;
        top: 15px;
        right: 15px;
        padding: 10px 20px;
        font-size: 20px;
        z-index: 6;
    }

    #mobileControls {
        position: absolute;
        bottom: 20px;
        width: 100%;
        display: flex;
        justify-content: space-between;
        padding: 0 20px;
        z-index: 6;
    }

    .mBtn {
        padding: 20px 35px;
        font-size: 30px;
        border-radius: 15px;
    }
</style>
</head>
<body>

<!-- ANA MENÜ -->
<div id="menu">
    <h1 style="font-size:48px; color:white;">ÇİZGİDEN KAÇIŞ</h1>
    <button onclick="startGame()">BAŞLA</button>
    <button onclick="openSettings()">Ayarlar</button>
</div>

<!-- DURDUR MENÜSÜ -->
<div id="pauseMenu" style="display:none;">
    <h1>Durduruldu</h1>
    <button onclick="resumeGame()">Devam Et</button>
    <button onclick="restartGame()">Tekrar Oyna</button>
    <button onclick="returnMenu()">Ana Menü</button>
</div>

<!-- AYARLAR MENÜSÜ -->
<div id="settingsMenu" style="display:none;">
    <h2>Ayarlar</h2>
    <p>Buraya ileride ses, kalite ayarları eklersin.</p>
    <button onclick="closeSettings()">Geri</button>
</div>

<button id="pauseBtn" style="display:none;" onclick="pauseGame()">II</button>

<!-- MOBİL KONTROLLER -->
<div id="mobileControls" style="display:none;">
    <button class="mBtn" id="leftBtn">◀</button>
    <button class="mBtn" id="rightBtn">▶</button>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
resizeCanvas();

let lastTime = 0;
let gameRunning = false;
let paused = false;

let player = { x: 200, y: 500, width: 40, height: 40, speed: 300 };
let obstacles = [];
let spawnTimer = 0;
let spawnRate = 900;
let score = 0;
let level = 1;

let moveLeft = false;
let moveRight = false;

window.onresize = resizeCanvas;
function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}

// ENGEL OLUŞTURMA
function spawnObstacle() {
    obstacles.push({
        x: Math.random() * (canvas.width - 40),
        y: -40,
        width: 40,
        height: 40,
        speed: 280
    });
}

// ANA OYUN
function gameLoop(timestamp) {
    if (!gameRunning || paused) return;
    requestAnimationFrame(gameLoop);

    let delta = (timestamp - lastTime) / 1000;
    lastTime = timestamp;

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    score += delta * 60;

    // LEVEL SİSTEMİ
    if (score >= level * 150) level++;

    // HAREKET
    if (moveLeft) player.x -= player.speed * delta;
    if (moveRight) player.x += player.speed * delta;
    player.x = Math.max(0, Math.min(canvas.width - player.width, player.x));

    // ENGELLER
    spawnTimer += delta * 1000;
    if (spawnTimer > spawnRate) {
        spawnTimer = 0;
        spawnObstacle();
    }

    obstacles.forEach(o => {
        o.y += o.speed * delta;

        ctx.fillStyle = "white";
        ctx.fillRect(o.x, o.y, o.width, o.height);

        if (isColliding(player, o)) gameOver();
    });

    obstacles = obstacles.filter(o => o.y < canvas.height + 50);

    // PLAYER
    ctx.fillStyle = "yellow";
    ctx.fillRect(player.x, player.y, player.width, player.height);

    // SCORE
    ctx.fillStyle = "white";
    ctx.font = "28px Arial";
    ctx.fillText("Skor: " + Math.floor(score), 20, 40);
    ctx.fillText("Seviye: " + level, 20, 80);
}

function isColliding(a, b) {
    return a.x < b.x + b.width &&
           a.x + a.width > b.x &&
           a.y < b.y + b.height &&
           a.y + a.height > b.y;
}

// OYUN BAŞLAT
function startGame() {
    document.getElementById("menu").style.display = "none";
    document.getElementById("pauseBtn").style.display = "block";
    document.getElementById("mobileControls").style.display = "flex";

    resetGame();
    gameRunning = true;
    paused = false;
    requestAnimationFrame(gameLoop);
}

function resetGame() {
    player.x = canvas.width / 2 - 20;
    obstacles = [];
    score = 0;
    level = 1;
}

// DURDUR
function pauseGame() {
    paused = true;
    document.getElementById("pauseMenu").style.display = "flex";
}

// DEVAM
function resumeGame() {
    paused = false;
    document.getElementById("pauseMenu").style.display = "none";
    requestAnimationFrame(gameLoop);
}

// TEKRAR OYNA
function restartGame() {
    document.getElementById("pauseMenu").style.display = "none";
    resetGame();
    paused = false;
    requestAnimationFrame(gameLoop);
}

// ANA MENÜ
function returnMenu() {
    location.reload();
}

// AYARLAR
function openSettings() {
    document.getElementById("menu").style.display = "none";
    document.getElementById("settingsMenu").style.display = "flex";
}
function closeSettings() {
    document.getElementById("settingsMenu").style.display = "none";
    document.getElementById("menu").style.display = "flex";
}

// PC KONTROLLERİ
document.addEventListener("keydown", e => {
    if (e.key === "ArrowLeft") moveLeft = true;
    if (e.key === "ArrowRight") moveRight = true;
});
document.addEventListener("keyup", e => {
    if (e.key === "ArrowLeft") moveLeft = false;
    if (e.key === "ArrowRight") moveRight = false;
});

// MOBİL KONTROL
document.getElementById("leftBtn").ontouchstart = () => moveLeft = true;
document.getElementById("leftBtn").ontouchend = () => moveLeft = false;

document.getElementById("rightBtn").onttouchstart = () => moveRight = true;
document.getElementById("rightBtn").onttouchend = () => moveRight = false;

</script>

</body>
</html>
